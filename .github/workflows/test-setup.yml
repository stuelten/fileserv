name: start-test-setup

on:
  workflow_dispatch:

jobs:
  test-setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Set up GraalVM
        uses: graalvm/setup-graalvm@v1
        with:
          java-version: '21'
          distribution: 'graalvm'
          github-token: ${{ secrets.GITHUB_TOKEN }}
          native-image-job-reports: 'true'
          cache: 'maven'

      - name: Build and Run Full Test Setup
        run: |
          chmod +x test/run-full-test.sh
          ./test/run-full-test.sh -q

      - name: Check container logs on failure
        if: failure()
        run: |
          docker compose logs || docker-compose logs || podman-compose logs || true
